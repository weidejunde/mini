<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PEZ0XRXXQC"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-PEZ0XRXXQC');
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yaozu IPA - Look up Yao Language Pronunciation | Tra c·ª©u Ph√°t √¢m ti·∫øng Dao</title>
    <meta name="description" content="Tra c·ª©u ph√°t √¢m ti·∫øng Dao b·∫±ng k√Ω hi·ªáu IPA. H·ªó tr·ª£ ng∆∞·ªùi h·ªçc v√† nghi√™n c·ª©u ng√¥n ng·ªØ Dao d·ªÖ d√†ng v√† ch√≠nh x√°c." />

    <!-- Favicon -->
    <link rel="icon" href="https://img.icons8.com/3d-fluency/94/bookmark.png" type="image/png">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="styles.css">  <!-- Header styles -->
    <link rel="stylesheet" href="css/ipa.css">
    <link rel="stylesheet" href="css/root.css">
</head>

<body>
    <!-- Header placeholder -->
    <div id="header-placeholder"></div>
    <div id="tieudex" style="display: none;">IPA</div>
    <main class="ipa-content">
        <div class="ipa-controls">
            <!-- Dialect selector and conversion toggle -->
            <div id="button-container">
                <select 
                    id="ch·ªçnPh∆∞∆°ngNg·ªØIPA" 
                    onchange="t·∫£iFileExcel()"
                    aria-label="Ch·ªçn ph∆∞∆°ng ng·ªØ"
                >
                </select>
                <div id="nut">
                    <button 
                        onclick="toggleChuy·ªÉnƒê·ªïiIPA()"
                        aria-label="Chuy·ªÉn ƒë·ªïi k√Ω hi·ªáu"
                    >
                        À©‚áî1
                    </button>
                </div>
            </div>

            <!-- Input fields -->
            <div id="input-container">
                <input 
                    type="text" 
                    id="timkiemx" 
                    placeholder="Nh·∫≠p t·ª´ c·∫ßn tra c·ª©u..." 
                    aria-label="Nh·∫≠p d·ªØ li·ªáu"
                    oninput="x·ª≠L√Ωƒê·∫ßuV√†o()"
                >
            </div>

            <!-- Processing display -->
            <div id="chu·ªóiTh·ª±cT·∫øKhiX·ª≠L√Ω" aria-live="polite"></div>

            <!-- Filter input -->
            <div class="filter-container">
                <input 
                    type="text" 
                    id="√¥Nh·∫≠pL·ªçc" 
                    placeholder="L·ªçc k·∫øt qu·∫£..." 
                    aria-label="L·ªçc k·∫øt qu·∫£"
                    oninput="locTieuDe()"
                >
            </div>

            <!-- Search results -->
            <div 
                id="k·∫øtQu·∫£T√¨mKi·∫øm" 
                aria-live="polite"
            >
                üîÑ
            </div>
        </div>

        <!-- Data table container -->
        <div class="table-container">
            <div id="khungB·∫£ng"></div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="loadHeader.js"></script>
    <script src="lib/xlsx.full.min.js"></script>
    <script src="js/iframe.js"></script>
<script>
let jsonData = [];  // Bi·∫øn l∆∞u tr·ªØ d·ªØ li·ªáu t·ª´ Excel

// H√†m ƒë·ªçc v√† hi·ªÉn th·ªã d·ªØ li·ªáu t·ª´ file Excel
function t·∫£iFileExcel() {
    fetch('data/ipa.xlsx') // T·∫£i file dian.xlsx
        .then(response => response.arrayBuffer())
        .then(data => {
            const workbook = XLSX.read(data, { type: 'array' });

            // L·∫•y t√™n c·ªßa sheet ƒë∆∞·ª£c ch·ªçn
            const selectedSheet = document.getElementById('ch·ªçnPh∆∞∆°ngNg·ªØIPA').value;

            // Ki·ªÉm tra v√† l·∫•y sheet ƒë∆∞·ª£c ch·ªçn
            const worksheet = workbook.Sheets[selectedSheet];
            if (!worksheet) {
                document.getElementById('khungB·∫£ng').innerHTML = `<p>Sheet '${selectedSheet}' kh√¥ng t·ªìn t·∫°i!</p>`;
                return;
            }

            // Chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu sheet th√†nh JSON, gi·ªØ √¥ tr·ªëng
            jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: '' });

            // Hi·ªÉn th·ªã d·ªØ li·ªáu d∆∞·ªõi d·∫°ng b·∫£ng HTML
            displayTable(jsonData);

            // C·∫≠p nh·∫≠t k·∫øt qu·∫£ t√¨m ki·∫øm sau khi ƒë·ªïi sheet
            x·ª≠L√Ωƒê·∫ßuV√†o();
        })
        .catch(error => {
            console.error('L·ªói khi ƒë·ªçc file Excel:', error);
            document.getElementById('khungB·∫£ng').innerHTML = "<p>L·ªói khi ƒë·ªçc file Excel.</p>";
        });
}

// H√†m hi·ªÉn th·ªã b·∫£ng
function displayTable(data) {
    const table = document.createElement('table');
    data.forEach((row, rowIndex) => {
        const tr = document.createElement('tr');
        row.forEach(cell => {
            const cellElement = document.createElement(rowIndex === 0 ? 'th' : 'td');
            cellElement.textContent = cell; // Hi·ªÉn th·ªã n·ªôi dung √¥
            tr.appendChild(cellElement);
        });
        table.appendChild(tr);
    });

    // Th√™m b·∫£ng v√†o trang
    const outputDiv = document.getElementById('khungB·∫£ng');
    outputDiv.innerHTML = ''; // X√≥a n·ªôi dung c≈©
    outputDiv.appendChild(table);
}

// T√°ch th√†nh ph·ª• √¢m, v·∫ßn, v√† thanh ƒëi·ªáu v·ªõi ∆∞u ti√™n thanh ƒëi·ªáu 2 k√Ω t·ª± tr∆∞·ªõc
function splitTerm(searchTerm) {
    const phuAmLengths = [5, 4, 3, 2, 1];
    const vanLengths = [4, 3, 2, 1];
    const thanhDieuLengths = [2, 1];
    let phuAm = '', van = '', thanhDieu = '';

    // T√¨m ph·ª• √¢m
    for (let len of phuAmLengths) {
        const potentialPhuAm = searchTerm.slice(0, len);
        if (isPhuAmValid(potentialPhuAm)) {
            phuAm = potentialPhuAm;
            searchTerm = searchTerm.slice(len);
            break;
        }
    }

    // T√¨m v·∫ßn
    for (let len of vanLengths) {
        const potentialVan = searchTerm.slice(0, len);
        if (isVanValid(potentialVan)) {
            van = potentialVan;
            searchTerm = searchTerm.slice(len);
            break;
        }
    }

    // T√¨m thanh ƒëi·ªáu, b·∫Øt ƒë·∫ßu t·ª´ k√Ω t·ª± th·ª© hai
    for (let len of thanhDieuLengths) {
        const potentialThanhDieu = searchTerm.slice(1, 1 + len);
        if (isThanhDieuValid(potentialThanhDieu) || potentialThanhDieu === '-') {
            thanhDieu = potentialThanhDieu;
            searchTerm = searchTerm.slice(1 + len);
            break;
        }
    }

    return { phuAm, van, thanhDieu };
}

function isPhuAmValid(phuAm) {
    return jsonData.some(row => row[0] === 'Ph·ª• √¢m' && row.includes(phuAm));
}

function isVanValid(van) {
    return jsonData.some(row => row[0] === 'V·∫ßn' && row.includes(van));
}

function isThanhDieuValid(thanhDieu) {
    return thanhDieu === '-' || jsonData.some(row => row[0] === 'Thanh ƒëi·ªáu' && row.includes(thanhDieu));
}

let ipaConversionEnabled = false;

function toggleChuy·ªÉnƒê·ªïiIPA() {
    ipaConversionEnabled = !ipaConversionEnabled;
    x·ª≠L√Ωƒê·∫ßuV√†o(); // G·ªçi l·∫°i h√†m x·ª≠L√Ωƒê·∫ßuV√†o ƒë·ªÉ c·∫≠p nh·∫≠t k·∫øt qu·∫£
}


function chuy·ªÉnƒê·ªïiThanhƒêi·ªáuIPA(tone) {
    const toneMap = {
        '5': 'À•',
        '4': 'À¶',
        '3': 'Àß',
        '2': 'À®',
        '1': 'À©',
        
    };

    return toneMap[tone] || tone;
}

function chuy·ªÉnƒê·ªïiK√ΩT·ª±MUN(searchTerm) {
    // Thay th·∫ø d·∫•u g·∫°ch ngang th√†nh 'j ' (j v√† kho·∫£ng tr·∫Øng)
    searchTerm = searchTerm.replace(/-/g, '- ');

    // Thay ƒë·ªïi p, t, k, q ·ªü cu·ªëi t·ª´ th√†nh p^, t^, k^, q^
    searchTerm = searchTerm.replace(/(p|t|k)(?=\s|$)/g, '$1^');

    // Thay ƒë·ªïi k√Ω t·ª± r, s, c, l sau p, t, k, q v√† ƒë·ª©ng cu·ªëi t·ª´
    searchTerm = searchTerm.replace(/(?<=[ptk])([rscl])(?=\s|$|-)/g, '^$1');

    // Thay ƒë·ªïi tr∆∞·ªùng h·ª£p p, t, k, q tr∆∞·ªõc d·∫•u g·∫°ch ngang
    searchTerm = searchTerm.replace(/(p|t|k)j/g, '$1^-' );

    // Quy t·∫Øc thay ƒë·ªïi 'iu-' th√†nh 'yu-'
    searchTerm = searchTerm.replace(/iu([mnptk])/g, 'yu$1');

    // Quy t·∫Øc thay ƒë·ªïi 'ui-' th√†nh 'wi-'
    searchTerm = searchTerm.replace(/ui([mnptk])/g, 'wi$1');

    // Quy t·∫Øc thay ƒë·ªïi 'i' th√†nh 'y'
    searchTerm = searchTerm.replace(/i([aƒÉeƒïiƒ≠o≈è√¥≈≠√¢])/g, 'y$1');

    // Quy t·∫Øc thay ƒë·ªïi 'u' th√†nh 'w' v·ªõi nguy√™n √¢m sau u
    searchTerm = searchTerm.replace(/u([aƒÉeƒï√™ƒ≠≈èu≈≠√¢])/g, 'w$1');

    // Quy t·∫Øc thay ƒë·ªïi 'nh' th√†nh 'ny' n·∫øu sau nh l√† m·ªôt ch·ªØ c√°i c·ª• th·ªÉ
    searchTerm = searchTerm.replace(/nh([aƒÉeƒïiƒ≠o√¥≈èu≈≠√¢])/g, 'ny$1');

    // Quy t·∫Øc thay ƒë·ªïi 'ƒ≠' th√†nh 'i' n·∫øu sau ƒë√≥ kh√¥ng ph·∫£i l√† (m n ng p t k)
    searchTerm = searchTerm.replace(/ƒ≠(?![iumnptk])/g, 'i');

    // Quy t·∫Øc thay ƒë·ªïi '≈≠' th√†nh 'u' n·∫øu sau ƒë√≥ kh√¥ng ph·∫£i l√† (m n ng p t k)
    searchTerm = searchTerm.replace(/≈≠(?![iumnptk])/g, 'u');



    return searchTerm;
}





function chuy·ªÉnƒê·ªïiK√ΩT·ª±MIEN(searchTerm) {
    // Thay th·∫ø d·∫•u g·∫°ch ngang th√†nh 'j ' (j v√† kho·∫£ng tr·∫Øng)
    searchTerm = searchTerm.replace(/-/g, '- ');

    // Thay ƒë·ªïi p, t, k, q ·ªü cu·ªëi t·ª´ th√†nh p^, t^, k^, q^
    searchTerm = searchTerm.replace(/(p|t|k|q)(?=\s|$)/g, '$1^');

    // Thay ƒë·ªïi k√Ω t·ª± r, s, c, l sau p, t, k, q v√† ƒë·ª©ng cu·ªëi t·ª´
    searchTerm = searchTerm.replace(/(?<=[ptkq])([rscl])(?=\s|$|-)/g, '^$1');

    // Thay ƒë·ªïi tr∆∞·ªùng h·ª£p p, t, k, q tr∆∞·ªõc d·∫•u g·∫°ch ngang
    searchTerm = searchTerm.replace(/(p|t|k|q)j/g, '$1^-');
    
    
// Quy t·∫Øc thay ƒë·ªïi 'nh' th√†nh 'ny' n·∫øu sau nh l√† m·ªôt ch·ªØ c√°i c·ª• th·ªÉ
searchTerm = searchTerm.replace(/nh([aƒÉeƒïiƒ≠o√¥≈èu≈≠√¢])/g, 'ny$1');

    // Quy t·∫Øc thay ƒë·ªïi 'i' th√†nh 'y'
    searchTerm = searchTerm.replace(/i([aƒÉo√¥u√¢])([mnptkq])/g, 'j$1$2');
    searchTerm = searchTerm.replace(/i([aƒÉ√™√¢])/g, 'j$1');

    // Quy t·∫Øc thay ƒë·ªïi 'u' th√†nh 'w'
    searchTerm = searchTerm.replace(/u([aƒÉe√™i√¢])([mnptkq])/g, 'w$1$2');
    searchTerm = searchTerm.replace(/u([aƒÉe√™√¢])/g, 'w$1');

    searchTerm = searchTerm.replace(/([y])ie/g, '$1y√™');
    searchTerm = searchTerm.replace(/([w])uo/g, '$1w√¥');
    searchTerm = searchTerm.replace(/ng/g, '≈ã');
    return searchTerm;
}
function x·ª≠L√Ωƒê·∫ßuV√†o() {
    let searchTerm = document.getElementById('timkiemx').value.trim().toLowerCase();

    // L·∫•y sheet ƒë∆∞·ª£c ch·ªçn t·ª´ select box
    const selectedSheet = document.getElementById('ch·ªçnPh∆∞∆°ngNg·ªØIPA').value;

    // ƒêi·ªÅu ch·ªânh k√Ω t·ª± tr∆∞·ªõc khi t√¨m ki·∫øm d·ª±a tr√™n sheet
    if (selectedSheet === "QMun") {
        searchTerm = chuy·ªÉnƒê·ªïiK√ΩT·ª±MUN(searchTerm);
    } else if (selectedSheet === "QMien") {
        searchTerm = chuy·ªÉnƒê·ªïiK√ΩT·ª±MIEN(searchTerm);
    }

    // Hi·ªÉn th·ªã k√Ω t·ª± th·ª±c t·∫ø sau x·ª≠ l√Ω
    document.getElementById('chu·ªóiTh·ª±cT·∫øKhiX·ª≠L√Ω').textContent = `${searchTerm}`;

    // Danh s√°ch c√°c c·ªôt c·∫ßn b·ªè qua (c·ªôt 1 v√† c·ªôt 2)
    const excludedColumns = [0, 1, 2, 3];

    // 1. L·∫•y c√°c ti√™u ƒë·ªÅ c·ªôt t·ª´ b·∫£ng, b·ªè qua c√°c c·ªôt trong danh s√°ch excludedColumns v√† c√°c c·ªôt ch·ª©a d·∫•u *
    const displayedHeaders = Array.from(document.querySelectorAll('#khungB·∫£ng th'))
        .map(th => th.textContent)
        .filter((header, index) => !excludedColumns.includes(index + 1) && !header.includes('*'));

    // 2. X√°c ƒë·ªãnh c√°c ch·ªâ s·ªë c·ªôt d·ª±a tr√™n ti√™u ƒë·ªÅ, b·ªè qua c√°c c·ªôt trong danh s√°ch excludedColumns v√† c√°c c·ªôt ch·ª©a d·∫•u *
    const columnIndices = displayedHeaders
        .map(header => jsonData[0].indexOf(header) + 1)
        .filter(index => !excludedColumns.includes(index));

    if (!searchTerm) {
        document.getElementById('k·∫øtQu·∫£T√¨mKi·∫øm').innerHTML = '';
        return;
    }

    // T√°ch c√°c t·ª´ ch·ªâ b·ªüi d·∫•u c√°ch
    const words = searchTerm.split(/\s+/);

    let results = [];
    let columnHeaders = columnIndices.map(index => jsonData[0][index - 1]); // L·∫•y ti√™u ƒë·ªÅ c·ªôt

    let foundResults = false; // Bi·∫øn ki·ªÉm tra n·∫øu c√≥ k·∫øt qu·∫£ h·ª£p l·ªá

    words.forEach(word => {
        const { phuAm, van, thanhDieu, nhanManh } = ∆∞uTi√™n√ÇmV·ªãD√†iNh·∫•t(word);

        // Ki·ªÉm tra n·∫øu kh√¥ng c√≥ v·∫ßn (l·ªói)
        if (!van) {
            results.push(`${word} (l·ªói)`);
            return; // Kh√¥ng l√†m g√¨ th√™m v·ªõi t·ª´ l·ªói n√†y
        }

        let combinedResults = [];
        columnIndices.forEach(index => {
            let phuAmResult = '', vanResult = '', thanhDieuResult = '', nhanManhResult = '';

            // T√¨m ph·ª• √¢m trong c·ªôt ch·ªâ ƒë·ªãnh
            if (phuAm) {
                const phuAmRow = jsonData.find(row => row[0] === 'Ph·ª• √¢m' && row[2] === phuAm);
                if (phuAmRow) {
                    phuAmResult = phuAmRow[index - 1];
                }
            }

            // T√¨m v·∫ßn trong c·ªôt ch·ªâ ƒë·ªãnh
            const vanRow = jsonData.find(row => row[0] === 'V·∫ßn' && row[2] === van);
            if (vanRow) {
                vanResult = vanRow[index - 1];
            } else {
                results.push(`${word} (l·ªói)`);  // Th√™m th√¥ng b√°o l·ªói cho t·ª´ n√†y
                foundResults = false; // Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ h·ª£p l·ªá
                return;
            }

            // T√¨m thanh ƒëi·ªáu trong c·ªôt ch·ªâ ƒë·ªãnh
            if (thanhDieu) {
                const thanhDieuRow = jsonData.find(row => row[0] === 'Thanh ƒëi·ªáu' && row[2] === thanhDieu);
                if (thanhDieuRow) {
                    thanhDieuResult = thanhDieuRow[index - 1];
                }
            }

            // T√¨m nh·∫•n m·∫°nh trong c·ªôt ch·ªâ ƒë·ªãnh
            if (nhanManh) {
                const nhanManhRow = jsonData.find(row => row[0] === 'Nh·∫•n m·∫°nh' && row[2] === nhanManh);
                if (nhanManhRow) {
                    nhanManhResult = nhanManhRow[index - 1];
                }
            }

            let result = [
    `<span style="color:#FF9966">${phuAmResult}</span>`,
    `<span style="color:#FF9966">${vanResult}</span>`,
    `<span style="color:#99CC00">${thanhDieuResult}</span>`,
    `<span style="color:gray">${nhanManhResult}</span>`
].join(''); // K·∫øt h·ª£p c√°c ph·∫ßn t·ª≠ l·∫°i v·ªõi nhau m√† kh√¥ng c√≥ kho·∫£ng c√°ch gi·ªØa ch√∫ng

if (ipaConversionEnabled) {
    result = result.split('').map(char => (char === '.' ? char : chuy·ªÉnƒê·ªïiThanhƒêi·ªáuIPA(char))).join('');
}

const cleanedResult = result.replace(/\(.*?\)/g, '').trim();

if (cleanedResult) {
    foundResults = true;
    combinedResults.push(cleanedResult);
}

        
        });

        // N·∫øu c√≥ k·∫øt qu·∫£ h·ª£p l·ªá, th√™m v√†o k·∫øt qu·∫£ cu·ªëi c√πng
        if (combinedResults.length) {
            results.push(combinedResults);
        } else {
            results.push(`${word} (l·ªói)`); // Th√™m th√¥ng b√°o l·ªói cho t·ª´ n√†y
        }
    });

    // N·∫øu kh√¥ng c√≥ k·∫øt qu·∫£ h·ª£p l·ªá, ·∫©n c√°c c·ªôt hi·ªÉn th·ªã
    if (!foundResults) {
        document.getElementById('k·∫øtQu·∫£T√¨mKi·∫øm').innerHTML = '<div class="th√¥ngB√°oL·ªói"></div>';
        document.querySelectorAll('.column-result').forEach(col => col.style.display = 'none');
        return;
    }

    // Hi·ªÉn th·ªã k·∫øt qu·∫£ ri√™ng bi·ªát cho t·ª´ng c·ªôt ch·ªâ khi c√≥ ti√™u ƒë·ªÅ c·ªôt
    let outputHTML = '';
    columnIndices.forEach((index, colIdx) => {
        const header = columnHeaders[colIdx];
        if (header) { // Ch·ªâ hi·ªÉn th·ªã c·ªôt c√≥ ti√™u ƒë·ªÅ
            const columnResults = results.map(result => result[colIdx]).filter(Boolean);

            // Ki·ªÉm tra n·∫øu c·ªôt c√≥ k·∫øt qu·∫£
            if (columnResults.length > 0) {
                outputHTML += `<div class="column-result">`;
                outputHTML += `<div class="ti√™uƒê·ªÅK·∫øtQu·∫£">${header}</div>`;
                outputHTML += `<div class="n·ªôiDungK·∫øtQu·∫£">${columnResults.join(' ')}</div>`;
                outputHTML += `</div>`;
            }
        }
    });

    // C·∫≠p nh·∫≠t ph·∫ßn t·ª≠ HTML ƒë·ªÉ hi·ªÉn th·ªã k·∫øt qu·∫£
    document.getElementById('k·∫øtQu·∫£T√¨mKi·∫øm').innerHTML = outputHTML;

    const searchOutput = document.getElementById('k·∫øtQu·∫£T√¨mKi·∫øm');

    // X√≥a d·∫•u c√°ch sau d·∫•u ch·∫•m v√† k√Ω t·ª± *
    searchOutput.innerHTML = searchOutput.innerHTML
        .replace(/\. /g, '.') // Thay '. ' th√†nh '.'
        .replace(/‚ù§ /g, '')  // Thay '& ' th√†nh ''
        .replace(/\* /g, ''); // Thay '* ' th√†nh ''

    // Sau khi hi·ªÉn th·ªã k·∫øt qu·∫£, √°p d·ª•ng l·∫°i b·ªô l·ªçc
    const filterText = document.getElementById('√¥Nh·∫≠pL·ªçc').value.trim().toLowerCase();
    if (filterText) {
        locTieuDe(); // G·ªçi l·∫°i h√†m l·ªçc
    }
}




    function ∆∞uTi√™n√ÇmV·ªãD√†iNh·∫•t(searchTerm) {
        const phuAmLengths = [4, 3, 2, 1];
        const vanLengths = [3, 2, 1];
        const thanhDieuLengths = [3, 2, 1];
        const nhanManhLengths = [2, 1];
        let phuAm = '', van = '', thanhDieu = '', nhanManh = '';

        // T√¨m ph·ª• √¢m
        for (let len of phuAmLengths) {
            const potentialPhuAm = searchTerm.slice(0, len);
            if (isPhuAmValid(potentialPhuAm)) {
                phuAm = potentialPhuAm;
                searchTerm = searchTerm.slice(len);
                break;
            }
        }

        // T√¨m v·∫ßn
        for (let len of vanLengths) {
            const potentialVan = searchTerm.slice(0, len);
            if (isVanValid(potentialVan)) {
                van = potentialVan;
                searchTerm = searchTerm.slice(len);
                break;
            }
        }

        // T√¨m nh·∫•n m·∫°nh tr∆∞·ªõc, n·∫øu c√≥ th√¨ b·ªè qua thanh ƒëi·ªáu
        for (let len of nhanManhLengths) {
            const potentialNhanManh = searchTerm.slice(-len); // L·∫•y t·ª´ cu·ªëi t·ª´
            if (isNhanManhValid(potentialNhanManh)) {
                nhanManh = potentialNhanManh;
                searchTerm = searchTerm.slice(0, -len);
                break;
            }
        }

        // N·∫øu kh√¥ng c√≥ nh·∫•n m·∫°nh, t√¨m thanh ƒëi·ªáu
        if (!nhanManh) {
            for (let len of thanhDieuLengths) {
                const potentialThanhDieu = searchTerm.slice(-len); // L·∫•y t·ª´ cu·ªëi t·ª´
                if (isThanhDieuValid(potentialThanhDieu) || potentialThanhDieu === '-') {
                    thanhDieu = potentialThanhDieu;
                    searchTerm = searchTerm.slice(0, -len);
                    break;
                }
            }
        }

        return { phuAm, van, thanhDieu, nhanManh };
    }

    function isNhanManhValid(nhanManh) {
        return jsonData.some(row => row[0] === 'Nh·∫•n m·∫°nh' && row.includes(nhanManh));
    }
    document.addEventListener('DOMContentLoaded', function() {
    let pressStartTime = 0;

});

function toggleIPAForElement(element) {
    // L·∫•y n·ªôi dung hi·ªán t·∫°i
    let currentContent = element.textContent.trim();
    
    // Ki·ªÉm tra xem n·ªôi dung ƒë√£ ƒë∆∞·ª£c chuy·ªÉn ƒë·ªïi IPA ch∆∞a
    const isIPAConverted = element.getAttribute('data-ipa-converted') === 'true';
    
    if (!isIPAConverted) {
        // Chuy·ªÉn ƒë·ªïi sang IPA
        let convertedContent = currentContent.split('').map(char => 
            (char === '.' ? char : chuy·ªÉnƒê·ªïiThanhƒêi·ªáuIPA(char))
        ).join('');
        
        element.textContent = convertedContent;
        element.setAttribute('data-ipa-converted', 'true');
    } else {
        // Kh√¥i ph·ª•c l·∫°i n·ªôi dung g·ªëc
        element.textContent = currentContent.replace(/[À©À®ÀßÀ¶À•]/g, char => {
            const reverseMap = {
                'À©': '1',
                'À®': '2',
                'Àß': '3',
                'À¶': '4',
                'À•': '5'
            };
            return reverseMap[char] || char;
        });
        element.setAttribute('data-ipa-converted', 'false');
    }
}


    document.addEventListener('DOMContentLoaded', function() {
        
    const sheet = ["QMun", "QMien"]; // M·∫£ng c√°c sheet
    const sheetSelector = document.getElementById('ch·ªçnPh∆∞∆°ngNg·ªØIPA');
    const searchInput = document.getElementById('timkiemx');

    // Th√™m c√°c option v√†o select t·ª´ m·∫£ng sheet
    sheet.forEach(function(sheetName) {
        const option = document.createElement('option');
        option.value = sheetName;
        option.textContent = sheetName;
        sheetSelector.appendChild(option);
    });

    // L·∫•y tham s·ªë sheet v√† d·ªØ li·ªáu t√¨m ki·∫øm t·ª´ URL
    const urlParams = new URLSearchParams(window.location.search);
    const selectedSheet = sheet.find(sheetName => urlParams.has(sheetName)) || 'QMun'; // M·∫∑c ƒë·ªãnh l√† 'QMun' n·∫øu kh√¥ng c√≥ tham s·ªë sheet
    const searchQuery = urlParams.get(selectedSheet) || ''; // L·∫•y d·ªØ li·ªáu t√¨m ki·∫øm t·ª´ URL

    // Ch·ªçn sheet trong select box t·ª´ URL
    sheetSelector.value = selectedSheet;

    // Thay ƒë·ªïi d·∫•u g·∫°ch d∆∞·ªõi (_) th√†nh d·∫•u c√°ch ( ) trong √¥ t√¨m ki·∫øm
    if (searchQuery) {
        searchInput.value = searchQuery.replace(/_/g, ' '); // Thay th·∫ø t·∫•t c·∫£ d·∫•u _ th√†nh d·∫•u c√°ch
    }

    // G·ªçi h√†m t·∫£i d·ªØ li·ªáu n·∫øu c√≥ sheet ƒë∆∞·ª£c ch·ªçn
    t·∫£iFileExcel(); // T·∫£i d·ªØ li·ªáu Excel sau khi ƒë√£ ch·ªçn sheet

    // L·∫Øng nghe s·ª± ki·ªán thay ƒë·ªïi l·ª±a ch·ªçn sheet
    sheetSelector.addEventListener('change', function() {
        const selectedValue = sheetSelector.value;
        updateUrlWithSheet(selectedValue); // C·∫≠p nh·∫≠t URL khi ng∆∞·ªùi d√πng thay ƒë·ªïi sheet
    });

    // L·∫Øng nghe s·ª± ki·ªán nh·∫≠p li·ªáu v√†o √¥ t√¨m ki·∫øm
    searchInput.addEventListener('input', function() {
        const searchText = searchInput.value;
        updateUrlWithSearch(searchText); // C·∫≠p nh·∫≠t URL v·ªõi d·ªØ li·ªáu t√¨m ki·∫øm
    });

    // C·∫≠p nh·∫≠t URL v·ªõi tham s·ªë sheet m·ªõi v√† x√≥a tham s·ªë sheet c≈©
    function updateUrlWithSheet(sheetName) {
        const currentUrl = new URL(window.location.href);
        // X√≥a tham s·ªë sheet c≈© n·∫øu c√≥
        sheet.forEach(function(sheet) {
            currentUrl.searchParams.delete(sheet);
        });
        // Th√™m tham s·ªë sheet m·ªõi v√†o URL, nh∆∞ng gi·ªØ nguy√™n d·ªØ li·ªáu t√¨m ki·∫øm kh√¥ng m√£ h√≥a
        currentUrl.searchParams.set(sheetName, searchInput.value.replace(/ /g, '_')); // Thay d·∫•u c√°ch th√†nh _
        window.history.replaceState(null, '', currentUrl.toString()); // C·∫≠p nh·∫≠t URL m√† kh√¥ng t·∫£i l·∫°i trang
    }
    function updateUrlWithSearch(searchText) {
    const currentUrl = new URL(window.location.href);
    // Thay th·∫ø d·∫•u c√°ch th√†nh d·∫•u _ tr∆∞·ªõc khi m√£ h√≥a URL
    const formattedSearchText = searchText.replace(/ /g, '_');
    // C·∫≠p nh·∫≠t tham s·ªë t√¨m ki·∫øm cho sheet ƒë√£ ch·ªçn
    currentUrl.searchParams.set(selectedSheet, formattedSearchText); // Kh√¥ng m√£ h√≥a URL n·ªØa
    window.history.replaceState(null, '', currentUrl.toString()); // C·∫≠p nh·∫≠t URL m√† kh√¥ng t·∫£i l·∫°i trang
}

});
    // ·∫®n ph·∫ßn t·ª≠3, 

    document.getElementById("chu·ªóiTh·ª±cT·∫øKhiX·ª≠L√Ω").style.display = "none";
    document.getElementById("khungB·∫£ng").style.display = "none";
    document.addEventListener('DOMContentLoaded', function() {

    // T·ª± ƒë·ªông k√≠ch ho·∫°t chuy·ªÉn ƒë·ªïi IPA khi t·∫£i trang
    ipaConversionEnabled = true;
    x·ª≠L√Ωƒê·∫ßuV√†o(); // G·ªçi h√†m x·ª≠ l√Ω ƒë·∫ßu v√†o ƒë·ªÉ √°p d·ª•ng chuy·ªÉn ƒë·ªïi IPA
});
function locTieuDe() {
    // L·∫•y gi√° tr·ªã t·ª´ √¥ nh·∫≠p l·ªçc
    const filterText = document.getElementById('√¥Nh·∫≠pL·ªçc').value.trim().toLowerCase();
    
    // L·∫•y t·∫•t c·∫£ c√°c c·ªôt k·∫øt qu·∫£
    const resultColumns = document.querySelectorAll('.column-result');
    
    // Duy·ªát qua t·ª´ng c·ªôt ƒë·ªÉ l·ªçc
    resultColumns.forEach(column => {
        // L·∫•y ti√™u ƒë·ªÅ c·ªßa c·ªôt
        const titleElement = column.querySelector('.ti√™uƒê·ªÅK·∫øtQu·∫£');
        
        if (titleElement) {
            const title = titleElement.textContent.toLowerCase();
            
            // Ki·ªÉm tra n·∫øu ti√™u ƒë·ªÅ ch·ª©a t·ª´ kh√≥a l·ªçc
            if (title.includes(filterText)) {
                column.style.display = 'block'; // Hi·ªÉn th·ªã c·ªôt
            } else {
                column.style.display = 'none'; // ·∫®n c·ªôt
            }
        }
    });
}
    </script>
</body>
</html>